"use strict";(self.webpackChunkadmin_client=self.webpackChunkadmin_client||[]).push([[506],{2506:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var r=a(9379),n=a(5043),s=a(6446),i=a(5865),l=a(5456),o=a(3193),c=a(4225),d=a(6990),h=a(6943),u=a(579);const m=e=>{let{orders:t,updatingId:a,onStatusChange:r}=e;const[s,i]=(0,n.useState)(10),m=[{field:"order_code",headerName:"\u30aa\u30fc\u30c0\u30fc\u756a\u53f7",width:160},{field:"customer_name",headerName:"\u540d\u524d",width:120},{field:"phone",headerName:"\u96fb\u8a71\u756a\u53f7",width:130},{field:"total_price",headerName:"\u5408\u8a08",width:120,valueGetter:e=>"".concat(e.row.total_price," \u5186")},{field:"order_date",headerName:"\u914d\u9054\u6642\u9593",width:120},{field:"items",headerName:"\u5546\u54c1",width:200,sortable:!1,renderCell:e=>{const t=e.row.items||[];return(0,u.jsx)("div",{style:{whiteSpace:"normal",lineHeight:"1.4",padding:"4px 0"},children:0===t.length?"-":t.map(e=>(0,u.jsxs)("div",{children:[e.menu_name," - Size: ",e.size," \xd7 ",e.quantity]},e.id))})}},{field:"note",headerName:"\u8981\u671b",width:220,renderCell:e=>(0,u.jsx)("div",{style:{whiteSpace:"normal",wordWrap:"break-word",lineHeight:"1.4",padding:"4px 0"},children:e.value||""})},{field:"status",headerName:"\u72b6\u6cc1",width:180,renderCell:e=>{const t=h.FJ.find(t=>t.value===e.row.status);return(0,u.jsx)(o.A,{fullWidth:!0,size:"small",disabled:a===e.row.id,children:(0,u.jsx)(c.A,{value:e.row.status,onChange:t=>r(e.row.id,t.target.value),sx:{backgroundColor:t?t.color+"40":"transparent",color:t?t.color:"inherit",fontWeight:"bold",borderRadius:1},children:h.FJ.map(e=>(0,u.jsx)(d.A,{value:e.value,sx:{color:e.color},children:e.label},e.value))})})}},{field:"create_time",headerName:"\u4f5c\u6210\u65e5\u4ed8",width:120,valueGetter:e=>{var t;return null===(t=e.row.create_time)||void 0===t?void 0:t.slice(0,10)}}];return(0,u.jsx)("div",{style:{height:450,width:"100%"},children:(0,u.jsx)(l.z,{rows:t||[],columns:m,pageSize:s,onPageSizeChange:e=>i(e),rowsPerPageOptions:[10,50,100],pagination:!0,getRowId:e=>e.id,disableSelectionOnClick:!0,getRowHeight:()=>"auto"})})};var p=a(7784),v=a(9190),w=a(1906);const g=e=>{let{filterDate:t,setFilterDate:a,filterStatus:r,setFilterStatus:n,onReset:i}=e;return(0,u.jsxs)(s.A,{sx:{display:"flex",gap:2,mb:2},children:[(0,u.jsx)(p.A,{label:"\u65e5\u4ed8",type:"date",value:t,onChange:e=>a(e.target.value),InputLabelProps:{shrink:!0},size:"small"}),(0,u.jsxs)(o.A,{size:"small",sx:{minWidth:180},children:[(0,u.jsx)(v.A,{children:"\u72b6\u6cc1"}),(0,u.jsxs)(c.A,{label:"\u72b6\u6cc1",value:r,onChange:e=>n(e.target.value),children:[(0,u.jsx)(d.A,{value:"",children:"\u5168\u90e8"}),h.FJ.map(e=>(0,u.jsx)(d.A,{value:e.value,children:e.label},e.value))]})]}),(0,u.jsx)(w.A,{variant:"outlined",onClick:i,children:"Reset Filter"})]})};var x=a(6323),A=a(8729);const f=()=>{const[e,t]=(0,n.useState)([]),[a,l]=(0,n.useState)(""),[o,c]=(0,n.useState)(""),[d,h]=(0,n.useState)(null),[p,v]=(0,n.useState)(!0),{callApiWithToken:w}=(0,A.A)();(0,n.useEffect)(()=>{(async()=>{try{v(!0);const e=await w(x.Gb);t(e||[])}catch(e){console.error("API\u547c\u3076\u30a8\u30fc\u30e9\u30fc\u767a\u751f:",e)}finally{v(!1)}})()},[w]);const f=(0,n.useMemo)(()=>e.filter(e=>{const t=!a||e.create_time.startsWith(a),r=!o||e.status===o;return t&&r}),[e,a,o]);return(0,u.jsxs)(s.A,{children:[(0,u.jsx)(i.A,{variant:"h4",gutterBottom:!0,children:"\u30aa\u30fc\u30c0\u30fc"}),(0,u.jsx)(g,{filterDate:a,setFilterDate:l,filterStatus:o,setFilterStatus:c,onReset:()=>{l(""),c("")}}),p?(0,u.jsx)(i.A,{children:"\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059..."}):(0,u.jsx)(m,{orders:f,updatingId:d,onStatusChange:async(e,a)=>{h(e);try{await w(x.Kv,e,{status:a}),t(t=>t.map(t=>t.id===e?(0,r.A)((0,r.A)({},t),{},{status:a}):t))}catch(n){console.error("API\u547c\u3076\u30a8\u30fc\u30e9\u30fc\u767a\u751f:",n)}finally{h(null)}}})]})}},6323:(e,t,a)=>{a.d(t,{Gb:()=>i,Kv:()=>o,nr:()=>l});var r=a(9722),n=a(6943),s=a(1759);const i=async e=>{const{access_token:t,token_type:a}=e;try{const e=await r.A.get("".concat(n.B5,"/order"),{headers:{Authorization:"".concat(a," ").concat(t)}});return(0,s.y)(e,"\u30aa\u30fc\u30c0\u30fc\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(i){(0,s.h)(i)}},l=async(e,t)=>{const{access_token:a,token_type:i}=e;try{const e=await r.A.get("".concat(n.B5,"/order/revenue?year=").concat(t),{headers:{Authorization:"".concat(i," ").concat(a)}});return(0,s.y)(e,"\u30aa\u30fc\u30c0\u30fc\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(l){(0,s.h)(l)}},o=async(e,t,a)=>{const{access_token:i,token_type:l}=e;try{const e=await r.A.post("".concat(n.B5,"/order/update/").concat(t),a,{headers:{Authorization:"".concat(l," ").concat(i)}});return(0,s.y)(e,"\u30aa\u30fc\u30c0\u30fc\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(o){(0,s.h)(o)}}}}]);
//# sourceMappingURL=506.4a4b1885.chunk.js.map