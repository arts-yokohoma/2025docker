"use strict";(self.webpackChunkadmin_client=self.webpackChunkadmin_client||[]).push([[18],{3018:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var a=n(5043),o=n(6446),i=n(5865),r=n(35),l=n(6600),c=n(5316),s=n(9347),d=n(1906),h=n(7948),u=n(6559),x=n(6782),g=n(7784),m=n(3216),p=n(579);const y=e=>{let{filterDate:t,setFilterDate:n,onReset:a,selectionModel:i=[],onDeleteSelected:r,onEdit:l}=e;const c=(0,m.Zp)();return(0,p.jsxs)(o.A,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[(0,p.jsx)(g.A,{label:"\u65e5\u4ed8",type:"date",value:t,onChange:e=>n(e.target.value),InputLabelProps:{shrink:!0},size:"small"}),(0,p.jsx)(d.A,{variant:"outlined",onClick:a,children:"Reset Filter"}),(0,p.jsx)(o.A,{sx:{flexGrow:1}}),(0,p.jsxs)(d.A,{variant:"contained",color:"error",disabled:0===i.length,onClick:r,sx:{textTransform:"none",boxShadow:2,opacity:0===i.length?.5:1},children:["\ud83d\uddd1\ufe0f \u524a\u9664\uff08",i.length,"\uff09"]}),(0,p.jsx)(d.A,{variant:"contained",color:"info",disabled:1!==i.length,onClick:()=>l(c),sx:{textTransform:"none",boxShadow:2,opacity:1!==i.length?.5:1},children:"\u270f\ufe0f \u5909\u66f4"}),(0,p.jsx)(d.A,{variant:"contained",color:"primary",onClick:()=>c("/menu/form"),sx:{textTransform:"none",boxShadow:2},children:"\u2795 \u8ffd\u52a0"})]})};var f=n(5456),A=n(9379);const j=e=>{let{src:t,alt:n,width:o=80,height:i=60,style:r}=e;const[l,c]=(0,a.useState)(!1),[s,d]=(0,a.useState)(!1);return(0,p.jsx)("img",{src:s?"https://placehold.co/80x60?text=No+Image":l?t:"https://placehold.co/80x60?text=Loading",alt:n,width:o,height:i,style:(0,A.A)({objectFit:"cover",borderRadius:6,transition:"opacity 0.3s ease-in-out",boxShadow:"0 1px 4px rgba(0,0,0,0.15)"},r),onLoad:()=>c(!0),onError:()=>d(!0)})},w=e=>{let{menus:t,loading:n,selectionModel:i,setSelectionModel:r}=e;const[l,c]=(0,a.useState)(10),s=[{field:"id",headerName:"ID",width:90},{field:"image_url",headerName:"\u753b\u50cf",width:120,renderCell:e=>(0,p.jsx)(j,{src:e.value,alt:"menu",width:80,height:60})},{field:"name",headerName:"\u540d",width:200},{field:"category_name",headerName:"\u30ab\u30c6\u30b4\u30ea",width:150,valueGetter:e=>{var t;return(null===(t=e.row.category)||void 0===t?void 0:t.category_name)||""}},{field:"sizes",headerName:"\u30b5\u30a4\u30ba / \u4fa1\u683c",width:250,valueGetter:e=>{var t;return(null===(t=e.row.sizes)||void 0===t?void 0:t.map(e=>"".concat(e.size,": ").concat(e.price,"\u5186")).join(", "))||""}},{field:"is_liked",headerName:"\u4eba\u6c17",width:100,renderCell:e=>(0,p.jsx)("input",{type:"checkbox",checked:!!e.value,readOnly:!0})},{field:"create_time",headerName:"\u4f5c\u6210\u65e5\u4ed8",width:150,valueGetter:e=>{var t;return null===(t=e.row.create_time)||void 0===t?void 0:t.slice(0,10)}}];return(0,p.jsx)(o.A,{sx:{height:650,width:"100%"},children:(0,p.jsx)(f.z,{rows:t||[],columns:s,pageSize:l,onPageSizeChange:e=>c(e),rowsPerPageOptions:[10,50,100],pagination:!0,loading:n,getRowId:e=>e.id,checkboxSelection:!0,disableSelectionOnClick:!0,selectionModel:i,onSelectionModelChange:e=>{r(e)}})})};var v=n(8729);const k=()=>{const[e,t]=(0,a.useState)([]),[n,g]=(0,a.useState)(""),[m,f]=(0,a.useState)(!1),[A,j]=(0,a.useState)([]),[k,S]=(0,a.useState)(!1),[b,C]=(0,a.useState)(""),[_,z]=(0,a.useState)(!1),{callApiWithToken:D}=(0,v.A)();(0,a.useEffect)(()=>{(async()=>{f(!0);try{t(await(0,x.kZ)())}catch(e){console.error("fetching error",e)}finally{f(!1)}})()},[]);const M=e.filter(e=>!n||e.create_time.startsWith(n));return(0,p.jsxs)(o.A,{children:[(0,p.jsx)(i.A,{variant:"h4",gutterBottom:!0,children:"\u30e1\u30cb\u30e5\u30fc\u4e00\u89a7"}),(0,p.jsx)(y,{filterDate:n,setFilterDate:g,onReset:()=>g(""),selectionModel:A,onDeleteSelected:()=>{0!==A.length&&z(!0)},onEdit:t=>{if(1===A.length){t("form",{state:{initialData:e.find(e=>e.id===A[0])}})}}}),(0,p.jsx)(w,{menus:M,loading:m,selectionModel:A,setSelectionModel:j}),(0,p.jsxs)(r.A,{open:_,onClose:()=>z(!1),"aria-labelledby":"confirm-dialog-title",children:[(0,p.jsxs)(l.A,{id:"confirm-dialog-title",sx:{display:"flex",alignItems:"center",gap:1},children:[(0,p.jsx)(u.A,{color:"warning"}),"\u78ba\u8a8d"]}),(0,p.jsx)(c.A,{children:(0,p.jsxs)(i.A,{children:[A.length," \u4ef6\u306e\u30e1\u30cb\u30e5\u30fc\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"]})}),(0,p.jsxs)(s.A,{children:[(0,p.jsx)(d.A,{onClick:()=>z(!1),color:"inherit",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,p.jsx)(d.A,{onClick:async()=>{try{f(!0),await D(x.fd,{ids:A}),t(e=>e.filter(e=>!A.includes(e.id))),j([]),z(!1)}catch(e){C((null===e||void 0===e?void 0:e.message)||"\u524a\u9664\u306e\u5931\u6557."),S(!0)}finally{f(!1)}},color:"error",variant:"contained",disabled:m,children:"\u524a\u9664"})]})]}),(0,p.jsxs)(r.A,{open:k,onClose:()=>S(!1),"aria-labelledby":"error-dialog-title",children:[(0,p.jsxs)(l.A,{id:"error-dialog-title",sx:{display:"flex",alignItems:"center",gap:1},children:[(0,p.jsx)(h.A,{color:"error"}),"\u524a\u9664\u30a8\u30e9\u30fc"]}),(0,p.jsx)(c.A,{children:(0,p.jsx)(i.A,{color:"error",children:b})}),(0,p.jsx)(s.A,{children:(0,p.jsx)(d.A,{onClick:()=>S(!1),color:"primary",autoFocus:!0,children:"\u30aa\u30fc\u30b1\u30fc"})})]})]})}},6782:(e,t,n)=>{n.d(t,{ES:()=>l,fd:()=>s,kZ:()=>r,lH:()=>c});var a=n(9722),o=n(6943),i=n(1759);const r=async()=>{try{const e=await a.A.get("".concat(o.B5,"/menu"));return(0,i.y)(e,"\u30e1\u30cb\u30e5\u30fc\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(e){(0,i.h)(e)}},l=async(e,t)=>{const{access_token:n,token_type:r}=e;try{const e=await a.A.post("".concat(o.B5,"/menu/create"),t,{headers:{Authorization:"".concat(r," ").concat(n)}});return(0,i.y)(e,"\u30e1\u30cb\u30e5\u30fc\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(l){(0,i.h)(l)}},c=async(e,t,n)=>{const{access_token:r,token_type:l}=e;try{const e=await a.A.put("".concat(o.B5,"/menu/update/").concat(t),n,{headers:{Authorization:"".concat(l," ").concat(r)}});return(0,i.y)(e,"\u30e1\u30cb\u30e5\u30fc\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(c){(0,i.h)(c)}},s=async(e,t)=>{const{access_token:n,token_type:r}=e;try{const e=await a.A.post("".concat(o.B5,"/menu/delete"),t,{headers:{Authorization:"".concat(r," ").concat(n)}});return(0,i.y)(e,"\u30e1\u30cb\u30e5\u30fc\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(l){(0,i.h)(l)}}}}]);
//# sourceMappingURL=18.dd66ea49.chunk.js.map